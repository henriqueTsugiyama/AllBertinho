{"ast":null,"code":"import _regeneratorRuntime from\"/home/henrique_yasuo/Documents/AllBertinho/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(signInRequest),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(persistRehyadrate);import{takeLatest,call,put,all}from'redux-saga/effects';import{createBrowserHistory}from'history';import store from'../../../store';import{signInSuccess,signInFailure}from'./actions';import api from'../../../services/api';import{toast}from'react-toastify';var history=createBrowserHistory();export function signInRequest(_ref){var payload,email,password,response,_response$data,user,token,admin;return _regeneratorRuntime.wrap(function signInRequest$(_context){while(1){switch(_context.prev=_context.next){case 0:payload=_ref.payload;_context.prev=1;email=payload.email,password=payload.password;_context.next=5;return call(api.post,'signin',{email:email,password:password});case 5:response=_context.sent;_response$data=response.data,user=_response$data.user,token=_response$data.token;admin=user.admin;_context.next=10;return put(signInSuccess(token,user));case 10:api.defaults.headers[\"x-access-token\"]=token;if(!(admin===true)){_context.next=15;break;}history.push('/admin');window.location.reload();return _context.abrupt(\"return\");case 15:history.push('/voce');window.location.reload();_context.next=24;break;case 19:_context.prev=19;_context.t0=_context[\"catch\"](1);toast.error('Usu치rio ou senha inv치lidos!');_context.next=24;return put(signInFailure());case 24:case\"end\":return _context.stop();}}},_marked,null,[[1,19]]);}export function persistRehyadrate(_ref2){var payload,token;return _regeneratorRuntime.wrap(function persistRehyadrate$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:payload=_ref2.payload;token=store.getState().auth.token;if(token){_context2.next=4;break;}return _context2.abrupt(\"return\");case 4:api.defaults.headers[\"x-access-token\"]=token;case 5:case\"end\":return _context2.stop();}}},_marked2);}export default all([takeLatest('SIGNIN_REQUEST',signInRequest),takeLatest('persist/REHYDRATE',persistRehyadrate)]);","map":{"version":3,"sources":["/home/henrique_yasuo/Documents/AllBertinho/src/store/modules/auth/sagas.js"],"names":["signInRequest","persistRehyadrate","takeLatest","call","put","all","createBrowserHistory","store","signInSuccess","signInFailure","api","toast","history","payload","email","password","post","response","data","user","token","admin","defaults","headers","push","window","location","reload","error","getState","auth"],"mappings":"0MAUiBA,a,iDA6BAC,iB,EAvCjB,OAASC,UAAT,CAAqBC,IAArB,CAA2BC,GAA3B,CAAgCC,GAAhC,KAA2C,oBAA3C,CACA,OAASC,oBAAT,KAAqC,SAArC,CACA,MAAOC,CAAAA,KAAP,KAAkB,gBAAlB,CAEA,OAASC,aAAT,CAAwBC,aAAxB,KAA6C,WAA7C,CACA,MAAOC,CAAAA,GAAP,KAAgB,uBAAhB,CACA,OAASC,KAAT,KAAsB,gBAAtB,CAEA,GAAMC,CAAAA,OAAO,CAAGN,oBAAoB,EAApC,CAEA,MAAO,SAAUN,CAAAA,aAAV,iMAA0Ba,OAA1B,MAA0BA,OAA1B,iBAEKC,KAFL,CAEyBD,OAFzB,CAEKC,KAFL,CAEYC,QAFZ,CAEyBF,OAFzB,CAEYE,QAFZ,iBAGc,MAAMZ,CAAAA,IAAI,CAACO,GAAG,CAACM,IAAL,CAAW,QAAX,CAAqB,CAC9CF,KAAK,CAALA,KAD8C,CAE9CC,QAAQ,CAARA,QAF8C,CAArB,CAAV,CAHd,OAGGE,QAHH,8BAQqBA,QAAQ,CAACC,IAR9B,CAQKC,IARL,gBAQKA,IARL,CAQWC,KARX,gBAQWA,KARX,CASKC,KATL,CASeF,IATf,CASKE,KATL,kBAUH,MAAMjB,CAAAA,GAAG,CAACI,aAAa,CAACY,KAAD,CAAQD,IAAR,CAAd,CAAT,CAVG,QAWHT,GAAG,CAACY,QAAJ,CAAaC,OAAb,CAAqB,gBAArB,EAAyCH,KAAzC,CAXG,KAaCC,KAAK,GAAK,IAbX,2BAcDT,OAAO,CAACY,IAAR,CAAa,QAAb,EACAC,MAAM,CAACC,QAAP,CAAgBC,MAAhB,GAfC,yCAmBHf,OAAO,CAACY,IAAR,CAAa,OAAb,EACAC,MAAM,CAACC,QAAP,CAAgBC,MAAhB,GApBG,iFAuBHhB,KAAK,CAACiB,KAAN,CAAY,6BAAZ,EAvBG,iBAyBH,MAAMxB,CAAAA,GAAG,CAACK,aAAa,EAAd,CAAT,CAzBG,qEA6BP,MAAO,SAAUR,CAAAA,iBAAV,uJAA8BY,OAA9B,OAA8BA,OAA9B,CACGO,KADH,CACab,KAAK,CAACsB,QAAN,GAAiBC,IAD9B,CACGV,KADH,IAGDA,KAHC,mEAKLV,GAAG,CAACY,QAAJ,CAAaC,OAAb,CAAqB,gBAArB,EAAyCH,KAAzC,CALK,wDAQP,cAAef,CAAAA,GAAG,CAAC,CACjBH,UAAU,CAAC,gBAAD,CAAmBF,aAAnB,CADO,CAEjBE,UAAU,CAAC,mBAAD,CAAsBD,iBAAtB,CAFO,CAAD,CAAlB","sourcesContent":["import { takeLatest, call, put, all } from 'redux-saga/effects';\nimport { createBrowserHistory } from 'history';\nimport store from '../../../store';\n\nimport { signInSuccess, signInFailure } from './actions';\nimport api from '../../../services/api';\nimport { toast } from 'react-toastify';\n\nconst history = createBrowserHistory();\n\nexport function* signInRequest({ payload }) {\n  try {\n    const { email, password } = payload;\n    const response = yield call(api.post, 'signin', {\n      email,\n      password\n    });\n\n    const { user, token } = response.data;\n    const { admin } = user;\n    yield put(signInSuccess(token, user));\n    api.defaults.headers[\"x-access-token\"] = token;\n\n    if (admin === true) {\n      history.push('/admin');\n      window.location.reload();\n      return;\n    }\n\n    history.push('/voce');\n    window.location.reload();\n\n  }catch(err) {\n    toast.error('Usu치rio ou senha inv치lidos!');\n\n    yield put(signInFailure());\n  }\n}\n\nexport function* persistRehyadrate({ payload }) {\n  const { token } = store.getState().auth;\n  \n  if(!token) return;\n\n  api.defaults.headers[\"x-access-token\"] = token;\n}\n\nexport default all([\n  takeLatest('SIGNIN_REQUEST', signInRequest),\n  takeLatest('persist/REHYDRATE', persistRehyadrate)\n]);\n"]},"metadata":{},"sourceType":"module"}